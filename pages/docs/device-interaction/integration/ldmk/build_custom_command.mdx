import { Callout } from "nextra/components";

# Build a Custom Command

## Overview

To build your a custom command for interacting with a connected Ledger device:
1. Extend the `Command` class and implement the `getApdu` and `parseResponse` methods
2. Use the the `sendCommand` method to send it to a connected device

## Why Use Custom Commands?

Custom commands are preferable over the direct use of `sendApdu` because they encapsulate command logic, enhance reusability, and simplify error handling. This method abstracts the complexity of APDU interaction, making your code more maintainable and easier to understand.

## Example: MyCustomCommand Implementation

```typescript
export class MyCustomCommand
  implements Command<MyCustomResponse, MyCustomCommandArgs>
{
   args: GetAddressCommandArgs;

  constructor(args: GetAddressCommandArgs) {
    this.args = args;
  }

  getApdu(): Apdu {

    // Main args for the APDU
    const getEthAddressArgs: ApduBuilderArgs = {
      cla: 0xe0, // Command CLA
      ins: 0x02, // Command INS
      p1: 0x00, //Parameter P1
      p2: 0x00, //Parameter P1
    };

    //Add the data attache to the APDU with the builder
    const builder = new ApduBuilder(getEthAddressArgs);
    builder.add32BitUIntToData(0);
    ... // Add more data to the APDU
    return builder.build();
  }

  parseResponse(
    response: ApduResponse,
  ): CommandResult<GetAddressCommandResponse> {
    //Create Apdu Parser
    const parser = new ApduParser(response);

    // FIRST: check status word
    if (!CommandUtils.isSuccessResponse(response)) {
      return CommandResultFactory({
        error: GlobalCommandErrorHandler.handle(response),
      });
    }

    // Extract fields from the response
    const customAttributes1 = parser.extract8BitUInt();
    if (customAttributes1 === undefined) {
      return CommandResultFactory({
        error: new InvalidStatusWordError("Public key length is missing"),
      });
    }
    ... // Extract more fields from the response

    return CommandResultFactory({
      MyCustomResponse: {
        customAttributes1,
        customAttributes2,
        ...
      },
    });
  }
}
```

## Utilizing `ApduBuilder`

The `ApduBuilder` simplifies the construction of APDUs by providing methods to append different types of data. This abstraction allows for clean and organized command structures that can be easily maintained and understood.

## Utilizing `ApduParser`

The `ApduParser` provides methods to deconstruct device responses systematically. It ensures that status words are checked efficiently and handles any parsing logic, leading to cleaner and more robust response processing.
