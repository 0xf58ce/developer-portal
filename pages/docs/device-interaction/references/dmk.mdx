import { Callout } from "nextra/components";

# Device Management Kit

The Device Management Kit (DMK) serves as the foundational entry point for interfacing with Ledger devices. Designed with modularity in mind, it integrates with various libraries to facilitate device management.

## Main Features

- **Device Discovery and Connection**: 
  - Connect to Ledger devices via USB using [WebHID](https://developer.mozilla.org/en-US/docs/Web/API/WebHID_API).
  - Connect via Bluetooth Low Energy (BLE) using [WebBLE](https://developer.mozilla.org/en-US/docs/Web/API/Web_Bluetooth_API).
- **Device State Observation**: 
  - Monitor the state of connected Ledger devices.
- **APDU Command Execution**: 
  - Send custom Application Protocol Data Units (APDU) commands.
- **Pre-defined Commands Execution**:
  - Retrieve OS version, app and version information.
  - Open or close an app.
  - Get device battery status.
- **DeviceAction Execution**: 
  - Perform sequences of commands as defined by **DeviceAction**.

<Callout type="warning" emoji="⚠️">
At the moment we do not provide the possibility to distinguish two devices of the same model via WebHID to prevent connecting to the same device twice.
</Callout>

## Communication with a Ledger device

The DMK provides multiple methods to interact with Ledger devices.

### Sending APDU Commands

<Callout>
  Direct APDU command usage is generally not recommended for typical use cases. Prefer >using <codeCommand</code> or <code>DeviceAction</code> methods for simplicity and reliability.
</Callout>

You can send APDU commands to the device using the `sendApdu` method of the Device Management Kit instance (here `dmk`) instance.

<u>**Parameters**</u>:

- `sessionId`: *string* - Identifier of the device connection session.
- `apdu`: *UInt8Array* - Data bytes array to send to the device.

```typescript
await dmk.sendApdu({ sessionId, apdu });
```

### Executing Commands

Commands are pre-defined actions that you can send to the device.
Use the `sendCommand` method of the `dmk` instance to send a command to the device.

<u>**Parameters**</u>:
- `sessionId`: *string* - Identifier of the device connection session.
- `command`: *Command* - Command to be sent to the device.

```typescript
import { OpenAppCommand } from "@ledgerhq/device-management-kit";

const command = new OpenAppCommand("Bitcoin"); // Open the Bitcoin app
await dmk.sendCommand({ sessionId, command });
```

### Executing device Actions

Device actions are a set of commands that are executed in a sequence.
You can use the `executeDeviceAction` method of the `dmk` instance to execute a device action.

It is returning an observable that will emit different states of the action execution.
A device action is cancellable, you can cancel it by calling the `cancel` function returned by the `executeDeviceAction` method.

<u>**Parameters**</u>:
- `sessionId`: *string* - Identifier of the device connection session.
- `deviceAction`: *DeviceAction* - The`DeviceAction` to be sent to the device.

```typescript
const openAppDeviceAction = new OpenAppDeviceAction({ appName: "Bitcoin" });

const { observable, cancel } = await dmk.executeDeviceAction({
  sessionId,
  openAppDeviceAction,
});
```

## State Management

Monitor and manage device states during interaction:

- `connected`: The device is connected.
- `locked`: The device is locked. User needs to unlock it to perform operations.
- `busy`: The device is busy, hence not reachable.
- `disconnected`: The device is disconnected.
