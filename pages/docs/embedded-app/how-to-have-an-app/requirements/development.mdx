import { Callout } from 'nextra/components'

# Security

## Requirement Note

Your embedded app must comply with all the Security requirements (Updated in April 2023). Security aspect apply to building the code, testing, (including automated testing), the use of BOLOS flags, the derivation path, exception calls, the handling of key-derived secrets, the signing process. The list is not exhaustive.

Ledger will not pass the Security Audit for an App if potential errors have been detected by the Ledger guidelines enforcer GitHub workflow available [here](https://github.com/LedgerHQ/app-boilerplate/blob/master/.github/workflows/guidelines_enforcer.yml). This includes a static code analyzer and a checker which verifies icons, `Makefile`, `README.md` and some application parameters (detailed in the sections below).

Make sure you run this worflow in your GitHub repository and that all issues be corrected.

In addition, your repository must have a test folder that contains at least your functional tests. Unit tests are highly recommended.

## Introduction

Developing applications for Ledger devices is an intricate process. The security of the user funds relies on the fact that the application works in a correct and secure manner and that potential attackers cannot misuse it to extract private data and/or sign requests which are not authorized by the user. The app should guard against such attacks because they have a very low entry point -- a Ledger device attached to a compromised host might be a victim of the attacker's program sending invalid/non-standard requests to the device.

<Callout type="warning" emoji="⚠️">
  This guide is meant to be a summary of all important aspects of Ledger Apps security and it shall be read by developers before developing an app for Ledger.
</Callout>

## Development practices

This part details several tips and recommendations to assess the security of your Ledger app.

### Perform Manual Code Reviews

We encourage all written code to be peer-reviewed. Importantly, the review should have at least:

1. One reviewer proficient in C and knowing C security weaknesses.
2. One reviewer with a "hacker's mind" (looking at the code from the perspective of an attacker).

### Automate Code Reviews with Static Code Analysis

Our SDK provides a simple automated analysis on your application code. It is based on [Clang Static Analyzer](https://clang-analyzer.llvm.org/). To use it, refer to https://github.com/LedgerHQ/ledger-app-builder#code-static-analysis

It will output an HTML report describing all the potential vulnerabilities it has identified.

In addition, this analysis is also done as part as the Ledger guidelines enforcer GitHub workflow. Integrating such check in CI ensures no trivial vulnerability has been introduced in new code.

<Callout type="warning" emoji="⚠️">
  Ledger will not sign an app if potential errors have been detected by Clang Static Analyzer.
</Callout>


Rationale: Problems identified by the static analysis are easy to fix, and allow the security team to detect the more obvious vulnerabilities. Moreover, it prevents developers from using unsafe string manipulation functions such as `strcpy`. Using such tool improves code quality over time.

### Avoid Warnings during compilation

Apps must build with no warnings. This verification is also done as part of the Ledger guidelines enforcer GitHub workflow (verified during the static code analysis phase). No warning should be intentionally disabled.

<Callout type="warning" emoji="⚠️">
  Ledger will not sign an app if warnings are emitted during compilation.
</Callout>

Rationale : Former SDKs used to generate lots of errors - sometimes dozens - when compiling an application. This had the unfortunate consequence of discouraging developers from reading the compilation output and miss potentially important alerts that could be well be vulnerabilities.

### Test requirements and Code review

In order to ease security reviews and maintenance, the Ledger Security Team requires these development requirements to be met:

- Functional tests must be present. They should allow APDU testing thanks to the [Speculos](../tools/speculos) OS emulator (or a real device). We highly recommend to use [Ragger](https://github.com/LedgerHQ/ragger) and [Pytest](https://pytest.org) as a testing framework if tests are written in Python.
- Unit tests are strongly recommended - especially for critical functions like parsers - preferably in the `tests/` folder and relying on a standard framework like [cmocka](https://cmocka.org/). Having these allows building fuzzers more easily, ensuring a shorter review.

These best practices must be automated using GitHub actions to achieve continuous integration. The [functional tests workflow](https://github.com/LedgerHQ/app-boilerplate/blob/master/.github/workflows/build_and_functional_tests.yml) and [Unit tests workflow](https://github.com/LedgerHQ/app-boilerplate/blob/master/.github/workflows/unit_tests.yml) of the Boilerplate app act as a reference.
On top of that, we also encourage the following practices:

- Linting helps improving code quality and ensuring consistent coding style and resolving basic coding errors.
- Developing a fuzzer thanks to [libFuzzer](https://llvm.org/docs/LibFuzzer.html).
- Integration with the Coverity static code analysis tool helps finding security issues and software defects.

They should also be included in the GitHub workflow.

<Callout type="warning" emoji="⚠️">
  Ledger will not sign an app if functional tests are not present.
</Callout>
